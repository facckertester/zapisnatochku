<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ì—Ä–∞—Ñ–∏–∫ —Ç–æ—á–µ–∫</title>
  <style>
    :root {
      --bg: #f0f4f8;
      --fg: #333;
      --container-bg: #fff;
      --input-bg: #fff;
      --input-border: #ccc;
      --button-bg: #007bff;
      --button-fg: white;
    }

    body.dark {
      --bg: #1e1e1e;
      --fg: #f0f0f0;
      --container-bg: #2a2a2a;
      --input-bg: #333;
      --input-border: #666;
      --button-bg: #444;
      --button-fg: #f0f0f0;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 1rem;
      background: var(--bg);
      color: var(--fg);
      transition: all 0.3s ease;
    }

    .container {
      max-width: 500px;
      margin: auto;
      background: var(--container-bg);
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      transition: background 0.3s ease;
    }

    h2, h3 {
      text-align: center;
    }

    label {
      display: block;
      margin-top: 1rem;
    }

    input, select, button {
      width: 100%;
      box-sizing: border-box;
      padding: 10px;
      font-size: 1rem;
      border-radius: 5px;
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      color: var(--fg);
    }

    button {
      background: var(--button-bg);
      color: var(--button-fg);
      border: none;
      margin-top: 1rem;
      cursor: pointer;
    }

     #assignments > div {
      margin-bottom: 1.0em;
    }

    button:disabled {
      background: #aaa;
      cursor: not-allowed;
    }

    .entry {
      background: #f9f9f9;
      padding: 5px 10px;
      border-radius: 5px;
      margin-top: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #000;
    }

    .entry span {
      flex: 1;
    }

    .admin-section {
      margin-top: 2rem;
      border-top: 1px solid #ccc;
      padding-top: 1rem;
    }

    .week-selector {
      display: flex;
      align-items: stretch;
      gap: 5px;
      margin-bottom: 1rem;
    }

    .week-selector button {
      flex: 1;
      height: 44px;
      padding: 0;
      font-size: 0.9rem;
    }

    .week-selector input {
      height: 44px;
      text-align: center;
      font-weight: bold;
      flex: 2;
    }

    .edit-btn {
      margin-left: 10px;
      font-size: 1.1rem;
      background: none;
      border: none;
      color: #007bff;
      cursor: pointer;
    }

    .edit-btn:hover {
      color: #0056b3;
    }

    .danger {
      color: #dc3545;
    }

    .theme-toggle {
      text-align: center;
      margin-bottom: 1rem;
    }

    .theme-toggle button {
      width: auto;
      padding: 8px 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="theme-toggle">
      <button onclick="toggleTheme()" id="themeBtn">–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</button>
    </div>

    <h2>–ì—Ä–∞—Ñ–∏–∫ –ø–æ –Ω–µ–¥–µ–ª—è–º</h2>

    <div class="week-selector">
      <button onclick="changeWeek(-1)">‚Üê –ø—Ä–µ–¥. –Ω–µ–¥–µ–ª—è</button>
      <input type="text" id="week" readonly>
      <button onclick="changeWeek(1)">—Å–ª–µ–¥. –Ω–µ–¥–µ–ª—è ‚Üí</button>
    </div>

    <label for="name">–ò–º—è:</label>
    <input type="text" id="name">

    <label for="day">–î–µ–Ω—å –Ω–µ–¥–µ–ª–∏:</label>
    <select id="day">
      <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–Ω—å</option>
      <option>–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</option>
      <option>–í—Ç–æ—Ä–Ω–∏–∫</option>
      <option>–°—Ä–µ–¥–∞</option>
      <option>–ß–µ—Ç–≤–µ—Ä–≥</option>
      <option>–ü—è—Ç–Ω–∏—Ü–∞</option>
      <option>–°—É–±–±–æ—Ç–∞</option>
      <option>–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</option>
    </select>

    <label for="point">–¢–æ—á–∫–∞:</label>
    <select id="point">
      <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—á–∫—É</option>
      <option>–í–∞—Ç–∞ - –ú–æ—Ä–æ–∂–µ–Ω–æ–µ</option>
      <option>–ë–∞—Ç—É—Ç</option>
      <option>–ú–∞—à–∏–Ω–∫–∏ - –õ–∞–±–∏—Ä–∏–Ω—Ç</option>
      <option>–ê—Ä–∫–∞–¥–∞ - –¢–∏—Ä</option>
    </select>

    <button onclick="assignPoint()">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>

    <h3>–ù–∞–∑–Ω–∞—á–µ–Ω–∏—è</h3>
    <div id="assignments"></div>

    <div class="admin-section">
      <label for="adminPass">–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</label>
      <input type="password" id="adminPass">
      <button onclick="checkAdmin()">–í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω</button>

      <div id="adminControls" style="display:none;">
        <button onclick="resetWeek()" style="background:#dc3545;">–°–±—Ä–æ—Å–∏—Ç—å –Ω–µ–¥–µ–ª—é</button>
      </div>
    </div>
  </div>

  <script>
    const password = "2808";
    let isAdmin = false;
    let currentMonday = getMonday(new Date());
    let currentWeekKey = getWeekKey(currentMonday);
    let schedule = loadSchedule();

    function getMonday(date) {
      const d = new Date(date);
      const day = d.getDay();
      const diff = d.getDate() - (day === 0 ? 6 : day - 1);
      return new Date(d.setDate(diff));
    }

    function getWeekKey(mondayDate) {
      return mondayDate.toISOString().split("T")[0];
    }

    function formatWeek(mondayDate) {
      const sunday = new Date(mondayDate);
      sunday.setDate(mondayDate.getDate() + 6);
      return `${mondayDate.getDate()} ${getMonthName(mondayDate)} ‚Äî ${sunday.getDate()} ${getMonthName(sunday)}`;
    }

    function getMonthName(date) {
      return date.toLocaleString("ru-RU", { month: "long" });
    }

    function changeWeek(delta) {
      currentMonday.setDate(currentMonday.getDate() + delta * 7);
      currentWeekKey = getWeekKey(currentMonday);
      schedule = loadSchedule();
      document.getElementById("week").value = formatWeek(currentMonday);
      updateDisplay();
    }

    function assignPoint() {
      const name = document.getElementById("name").value.trim();
      const day = document.getElementById("day").value;
      const point = document.getElementById("point").value;

      if (!name || !day || !point) {
        alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è.");
        return;
      }

      if (!schedule[day]) schedule[day] = {};
      if (schedule[day][point]) {
        alert("–≠—Ç–∞ —Ç–æ—á–∫–∞ —É–∂–µ –∑–∞–Ω—è—Ç–∞ –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å.");
        return;
      }

      schedule[day][point] = name;
      saveSchedule();
      updateDisplay();
    }

    function updateDisplay() {
  const output = document.getElementById("assignments");
  output.innerHTML = "";

  const daysOrder = ["–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–í—Ç–æ—Ä–Ω–∏–∫", "–°—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä–≥", "–ü—è—Ç–Ω–∏—Ü–∞", "–°—É–±–±–æ—Ç–∞", "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"];

  daysOrder.forEach(day => {
    if (!schedule[day]) return;

    const points = schedule[day];
    const dayBlock = document.createElement("div");
    dayBlock.innerHTML = `<strong>${day}:</strong>`;

    Object.keys(points).forEach(pt => {
      const entry = document.createElement("div");
      entry.className = "entry";

      const span = document.createElement("span");
      span.textContent = `${pt} ‚Äî ${points[pt]}`;
      entry.appendChild(span);

      if (isAdmin) {
        const editBtn = document.createElement("button");
        editBtn.innerHTML = "‚úèÔ∏è";
        editBtn.className = "edit-btn";
        editBtn.title = "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å";
        editBtn.onclick = () => editEntry(day, pt);
        entry.appendChild(editBtn);

        const delBtn = document.createElement("button");
        delBtn.innerHTML = "üóëÔ∏è";
        delBtn.className = "edit-btn danger";
        delBtn.title = "–£–¥–∞–ª–∏—Ç—å";
        delBtn.onclick = () => deleteEntry(day, pt);
        entry.appendChild(delBtn);
      }

      dayBlock.appendChild(entry);
    });

    output.appendChild(dayBlock);
  });

  updateDisabledOptions();
}

    function updateDisabledOptions() {
      const day = document.getElementById("day").value;
      const pointSelect = document.getElementById("point");

      [...pointSelect.options].forEach(opt => {
        if (!opt.value) return;
        opt.disabled = false;
        if (schedule[day] && schedule[day][opt.value]) {
          opt.disabled = true;
        }
      });
    }

    document.getElementById("day").addEventListener("change", updateDisabledOptions);

    function checkAdmin() {
      const inputPass = document.getElementById("adminPass").value;
      if (inputPass === password) {
        isAdmin = true;
        document.getElementById("adminControls").style.display = "block";
        alert("–í—ã –≤–æ—à–ª–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.");
        updateDisplay();
      } else {
        alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å.");
      }
    }

    function resetWeek() {
      if (confirm("–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ?")) {
        localStorage.removeItem(currentWeekKey);
        schedule = {};
        updateDisplay();
      }
    }

    function loadSchedule() {
      const data = localStorage.getItem(currentWeekKey);
      return data ? JSON.parse(data) : {};
    }

    function saveSchedule() {
      localStorage.setItem(currentWeekKey, JSON.stringify(schedule));
    }

    function deleteEntry(day, point) {
      if (confirm(`–£–¥–∞–ª–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ "${point}" –≤ "${day}"?`)) {
        delete schedule[day][point];
        if (Object.keys(schedule[day]).length === 0) delete schedule[day];
        saveSchedule();
        updateDisplay();
      }
    }

    function editEntry(day, point) {
      const current = schedule[day][point];
      const newName = prompt(`–ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è –¥–ª—è "${point}" –≤ "${day}":`, current);
      if (newName && newName.trim()) {
        schedule[day][point] = newName.trim();
        saveSchedule();
        updateDisplay();
      }
    }

    function toggleTheme() {
      const body = document.body;
      const isDark = body.classList.toggle("dark");
      document.getElementById("themeBtn").textContent = isDark ? "–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞" : "–¢—ë–º–Ω–∞—è —Ç–µ–º–∞";
      localStorage.setItem("theme", isDark ? "dark" : "light");
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.getElementById("week").value = formatWeek(currentMonday);
    updateDisplay();

    // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–µ–º—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    (function applySavedTheme() {
      const saved = localStorage.getItem("theme");
      if (saved === "dark") {
        document.body.classList.add("dark");
        document.getElementById("themeBtn").textContent = "–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞";
      }
    })();
  </script>
</body>
</html>
